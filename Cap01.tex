%\pagestyle{fancy}
\chapter[Capítulo 1. Introducción]{}

\section{Consideraciones preliminares}

Actualmente, el transporte es de crucial importancia en la vida cotidiana. Como consecuencia, los vehículos están cada vez más equipados con dispositivos informáticos y electrónicos a bordo. Tanto las empresas como en los consumidores la demanda de conectividad en los vehículos está creciendo rápidamente, \cite{VWC}.

En la actualidad los automóviles cuentan con una serie de unidades de control que incluyen microprocesadores en diversos sistemas, tales como la unidad de control del motor, sistemas de transmisión, airbags, sistema de frenos anti-bloqueo, entre otros. A pesar de que varios de estos subsistemas son independientes del resto (ABS, Navegación, Tren Motriz, etc.), la comunicación entre otros subsistemas es esencial para la seguridad, el confort en el vehículo y para hacer mejor la estancia tanto del conductor como del pasajero en el caso de buses comerciales.

 El avance de la electrónica y de las comunicaciones ha sido uno de los motivos que han animado a los fabricantes de automóviles a introducir nuevas tecnologías para mejorar el funcionamiento de los sistemas existentes en los automóviles e incorporar otros nuevos, destinados a mejorar aspectos de seguridad, confort, mantenimiento, protección ambiental etc. El creciente número de ECUs  (Unidad de Control Electrónico) y la mayor demanda de prestaciones entre las que se encuentran las funciones de ayuda al diagnóstico, ha obligado a establecer una comunicación entre todos los sistemas electrónicos a bordo,  \cite{EA}.

Hoy en día en los automóviles y los buses se monitorizan muchas variables a fin de ajustar todos los parámetros al máximo (temperatura del motor, temperatura del combustible, temperatura y caudal del aire, sensor de oxigeno, etc.), \cite{DUCE}. La electrónica, como soporte básico en la construcción de vehículos, asume la difícil tarea evolutiva en el mundo de las comunicaciones y del transporte de  mejorar tanto el grado de confort como el nivel de seguridad activo y pasivo. Diferentes estudios sobre nuevas tecnologías favorecen la implementación de nuevas técnicas de fabricación e instrumentación, \cite{TSA}.


\section{Estado del Arte}

Con el protocolo BUS CAN nació la posibilidad de emplear redes versátiles en los automóviles, gracias a ello se pudo incorporar nuevos sensores y sistemas de control al interior del vehículo ahorrando en espacio y costos. Muchos son los proyectos que se han encaminado en la utilización de este protocolo, de manera a mejorar o agregar elementos útiles al conductor o mejorar el rendimiento de los automóviles, de hecho no solo en lo automovilístico sino también en el campo industrial adquirió gran importancia. Los proyectos más relevantes y las soluciones propuestas con este protocolo se describen en esta sección. Shane et al. \cite{IVN} muestra y realiza un estudio de la red interna de los vehículos modernos y como fueron avanzando estas redes a través de los años. Explica los distintos protocolos presentes Intra-Vehicle. Es útil conocer las distintas redes y aquí se observa las limitaciones y las ventajas de la red BUS CAN. Una de sus ventajas es el bajo costo del diseño de hardware y su fácil instalación, pero esta facilidad también nos muestra que no es posible por ejemplo recurrir al envío de informaciones de audio o video debido a su ancho de banda estrecho. Esto no quita el interes al protocolo ya que el costo es un factor importante en el desarrollo de los vehículos y el protocolo resulta ser muy accesible para muchas aplicaciones. El trabajo de Renjun et al. \cite{CMS} es una investigación en la cual se monitorea los módulos CAN presentes en el vehículo y puede almacenar dichos datos en algún archivo, pero lo realiza vía PC, es decir, se diseñó un programa para la computadora y no emplea ningún sistema embebido. Un trabajo que resulta de interés es el tema de Ma Yuguan et al. \cite {GHG} en donde realiza la monitorización y el control de un grupo de GreenHouse (casas de efecto invernadero). En todos los proyectos consultados las comunicaciones en BUSCAN se realizaban en una sola red, por lo cual resulta interesante  este proyecto porque realiza el control de las mismas con 2 (dos) redes  BUS CAN, una interna y otra externa. La red interna contiene todas las conecciones de los elementos necesarios para controlar el clima interior de las casas de efecto invernadero y la red externa realiza el control de todas las casas o grupos de GreenHouse.  De esta manera se demuestra que puede agregarse nuevas redes en el interior del vehículo, es decir, la red interna del vehículo ya viene de fabrica pero se le puede agregar una red externa para colocar nuevos sensores o sistemas de monitoreo que no están previstos en el vehículo, esta red externa puede obtener datos de la red interna para realizar cosas como por ejemplo: conteo de pasajeros, medir  temperatura del ambiente, colocar alarmas de alerta de límites de velocidad, sensor de contaminación del aire etc. Otro trabajo que apoya la idea descrita arriba es el proyecto de Dai \cite {DOR} donde muestra cómo agregando motores para el control de ventanas en un vehículo es posible que el control sea agregado a la red interna CAN del vehículo, es decir, no hace falta agregar otra red distinta en el mismo móvil, sino que en la red misma del vehículo se podrán enviar y recibir mensajes nuevos para nuevos módulos. Algo también para tener en cuenta es la seguridad de los datos en las redes BUS CAN de los cuales hablan los siguientes trabajos:
\cite{RS}, \cite{EP}, \cite{ADA} y \cite{RPA}. Pero en los cuales se utilizan algoritmos complejos para mejorar la seguridad de los mensajes en las redes CAN, la seguridad se refiere a que los datos no sean alterados debido al uso excesivo de la red CAN. Se pueden emplear también sensores inalámbricos y conectarlos a la red CAN del automóvil, esto evita la acumulación de cables en el vehículo y además puede ser útil para monitorear regiones poco accesibles para los métodos cableados: como la medición de presión en los neumáticos. Pero esto conlleva a algo más delicado que es la seguridad de los usuarios en los vehículos, ya que al ir evolucionando las redes internas de los autos estos están expuestos a ataques malintencionados como demuestra el trabajo de Samuel et al. \cite{ACAN},  en el cual los autores realizan una simulación de un ataque “hacker” a la red BUS CAN introduciendo datos falsos a los sensores inalámbricos, el “hacking” se realizó mediante un smartphone y el trabajo contempla un algoritmo de seguridad para evitarlo. Méreles \cite{PSMR} desarrolló un sistema de monitoreo de la energía consumida de la Batería de un vehículo eléctrico, la problemática se centraba en que era necesario saber en tiempo real el consumo de la energía del vehículo en vista a mejorar la autonomía y confiabilidad del vehículo eléctrico. El monitoreo se realizaba con el protocolo BUS CAN implementado en un embebido EasyPIC18, además de tener agregado módulos GPS y GPRS para enviar los datos monitoreados a una estación de base. Debido a la movilidad de los vehículos en general un sistema GPRS podría ser una buena Red para enviar los datos monitoreados, aunque también existen otras posibilidades de enviar inalámbricamente dichos datos si no se quiere abonar por el uso de la red GPRS, como lo desarrollan  Hock et al. \cite{DWCAN} en cuyo proyecto monitoreaban de la misma manera datos de un vehículo pero esta vez el vehículo estaba funcionando a energía solar, la problemática era saber la capacidad del vehículo para mantenerse estable y funcionando, además de que un hardware de monitoreo no debería consumir mucha energía de la batería. Estos datos eran monitoreados mediante el protocolo BUS CAN empleando un microcontrolador EasyArm 8962 cuyo datos se enviaban inalámbricamente a través de un  módulo inalámbrico denominado MaxStream X24-009, aunque no se abona por el uso de la transmisión de datos la desventaja es que la velocidad de transmisión está limitada a 9600 bps en comparación con los 56 kbps como mínimo en una red GPRS. Aún con dicha velocidad reducida el sistema es estable debido a que la respuesta de los sensores involucrados en el monitoreo son menores a 9600 bps. Para el desarrollo del proyecto también podrían usarse módulos  CAN comerciales, pero sus costos son elevados, Sinmaleza \cite{CMDI} desarrolló un modelo didáctico de una red BUS CAN para el control de la iluminación y señalización del automóvil de manera a facilitar la comprensión del funcionamiento de las luces en los vehículos. El modelo didáctico sirve para comprender las diferencias existentes entre el sistema de iluminación convencional y el sistema de iluminación con BUS CAN. Este sistema no desarrolla un sistema embebido sino que utiliza un  “Módulo de Control de Carrocería” que es un módulo comercial que se adapta al vehículo, se trata de una unidad que lleva el control, entre varias cosas, del sistema eléctrico del automóvil. El módulo realiza de interfaz entre los contactos, pulsadores e interruptores y la computadora principal del vehículo mediante el BUS CAN.  Es simplemente conectar las uniones entre conectores de luces en las entradas del módulo. 
Para el desarrollo del proyecto no es conveniente utilizar módulos comerciales pues no son escalables, no permiten introducir mejoras y sus costos son elevados. El sistema diseñado debe poder ser conectado a los vehículos que soporten protocolos BUS CAN, la conexión es posible debido a que el protocolo es abierto. La conexión eléctrica se realiza como muestra el trabajo de Santana et al. \cite{DISM}, en dicho trabajo el sistema fue desarrollado en base a microcontroladores y ajustado a la unidad de control del motor o ECU (Engine Control Unit, por sus siglas en inglés) del vehículo, con la misión de monitorear datos de la velocidad de un vehículo de carreras. Se debe agregar que la medición de velocidad se realizó con sensores elaborados por Santana, en nuestro caso el proyecto tratará de leer datos originales del vehículo y sólo si se requiere se podrían añadir otros sensores de interés para el presente proyecto. Para la elaboración del proyecto nace una pregunta crucial ¿Es posible desarrollar un hardware de bajo costo con altas capacidades de recolección de datos mediante el BUS CAN? Según varios proyectos si es posible,  como nos muestra The et al. \cite{HAMS}, dónde con componentes electrónicos disponibles en el Mercado desarrollan un sistema Domótico mediante el protocolo BUS CAN, aunque el sistema no tiene un tratamiento de datos, es decir, un sistema que interprete los datos medidos, es posible proveer de eso al sistema como lo hicieron  Burje et al. \cite{EOBD}, en el cual de la misma manera presentan una comunicación entre módulos BUS CAN, el cual se basaba en el monitoreo de sensores de temperaturas e interpretaban dichas mediciones con la implementación de un sistema OBD (On Board Diagnostic, por sus siglas en inglés) en un sistema embebido, demostrando que BUS CAN puede implementarse y además es posible expandir el protocolo a otros lugares fuera del ámbito automovilístico. El sistema OBD es una herramienta importante para interpretar las señales provistas por varios sensores y dar un mensaje al usuario de la acción a realizar para tratar dichos errores. Una alternativa para el desarrollo de hardware podría ser utilizar kits de desarrollo como lo hicieron Paturkar et al. \cite{AABT} cuyo objetivo fue la construcción de un prototipo de hardware industrial para medición de calor utilizando sensores de temperatura. En este trabajo el desarrollo del protocolo BUS CAN se basa netamente en el desarrollo del software, ya que utilizaron un Kit de ARM, es decir, un controlador ARM7–LPC2129 con CAN incorporado. El proyecto está diseñado con dos ARM7 en el cual uno de ellos monitorea los sensores y ante cualquier variación esto se comunica a través del BUS CAN al siguiente ARM7 el cual presenta dichos datos en un lenguaje entendible para el ser humano mediante una pantalla LCD. También Varghese \cite{ICAN} utilizó kits con microcontroladores de la familia HCS12, El MC9S12DP256B, que es un microcontrolador de 16 bits de alta velocidad proveído por FreeScale. Estos Kits aunque tienen la ventaja de traer todos los elementos hardware necesarios y permitir una mayor facilidad para la programación de los mismos, llevan consigo un tamaño relativamente voluminoso debido a que incorporan hardware extras que no son necesarios para el proyecto y se dificulta encontrar un lugar en el interior del vehículo para su conexión, además de que se necesita abonar un alto costo para su posesión.

%%%resumen de lo leído
El factor  común de los proyectos recopilados denota que se requiere de módulos específicos para trabajar con el protocolo BUS CAN, ya que las soluciones  utilizan módulos comerciales  o microcontroladores generales que incorpora dentro de si un mecanismo CAN, también en los proyectos estudiados vemos la gran flexibilidad que tiene el protocolo CAN para adaptarse a distintas soluciones de ingeniería desde aplicaciones con vehículos, GreenHouse, Vehículos eléctricos, vehículos a energía solar, sistemas domóticos,etc. También en dichos proyectos se requiere de un software que interprete los datos leídos del protocolo BUS CAN para los usuarios.  


%Analizando los distintos temas el presente proyecto pretende leer datos directamente de los sensores del vehículo accediendo a su bus interno, y una vez obtenido dichos datos analizar la información provista, teniendo en cuenta que el diseño y la implementación se realizará en un sistema embebido para una mejor optimización de recursos electrónicos y un menor costo del mismo.

 
 


%************************* Nueva Página *********************************
\newpage

\section{Objetivos}


\begin{center}
\textbf{Objetivo General}
\end{center}
Desarrollar un sistema prototipo de monitoreo de sensores y monitoreo de datos de subsistemas electrónicos presentes en vehículos modernos, utilizando el protocolo BUS CAN.
\begin{center}
\textbf{Objetivos Específicos}
\end{center}

\begin{itemize}
	\item	Implementar una plataforma de comunicación acorde al protocolo CAN para la obtención de mediciones de sensores y el monitoreo de datos de los subsistemas electrónicos presentes.
	
	\item Desarrollar una base de datos dónde se almacenarán los datos del vehículo a través del sistema de adquisición CAN.
	
	\item Diseñar y montar un prototipo que integre todos los componentes necesarios para la comunicación con los sensores del vehículo y los subsistemas.
	
	%\item 
		
\end{itemize}

\section{Alcance del Sistema}
 El presente proyecto pretende leer datos directamente de los sensores del vehículo accediendo a su bus interno y utilizando el estándar OBD II (\textit{On Board Diagnostics}, por sus siglas en inglés), una vez obtenido dichos datos se analizará la información provista.  El diseño y la implementación se realizará en un sistema embebido para una mejor optimización de recursos electrónicos y un menor costo del mismo. Con todo ello para la conformidad del proyecto se pretende leer sensores básicos del vehículo automotor como sensores de velocidad, revoluciones por minuto, Niveles de combustible, niveles de energía de batería entre otros. Durante el desarrollo se planea observar otros tipos de datos que pueda proveer el sistema electrónico del vehículo. También se pretende leer datos de un simulador del protocolo CAN que trabaja con el estándar J1939, que es un sistema para vehículos pesados. 
 
 
\section{Organización del Documento}


En el Capítulo $1$ se presentan las motivaciones para el desarrollo del TFG (Trabajo Final de Grado), así como los objetivos generales y específicos. En el Capítulo $2$ se presenta el marco teórico y los fundamentos del TFG. En el Capítulo $3$ se presenta el estudio técnico, en donde se define el problema y los requerimientos necesarios para la utilización del protocolo BUS CAN. En el Capítulo $4$ se describe el hardware necesario para la implementación del protocolo. En el Capítulo $5$  se describe el software del sistema de monitoreo del hardware y del servidor. Finalmente en el Capítulo $6$ se realizan las pruebas en un simulador y se exponen las conclusiones y futuros trabajos.




